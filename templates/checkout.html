{% extends "base.html" %}

{% block title %}Checkout{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Finalizar Compra</h1>
    
    <div class="row">
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Dirección de Entrega</h5>
                    <form id="checkoutForm" method="POST">
                        <div class="mb-3">
                            <label for="direccion" class="form-label">Dirección completa</label>
                            <textarea class="form-control" id="direccion" name="direccion" rows="3" required>{{ current_user.direccion }}</textarea>
                        </div>
                        
                        <h5 class="card-title mt-4">Método de Pago</h5>
                        <div class="mb-3">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="metodo_pago" id="tarjeta" value="tarjeta" checked>
                                <label class="form-check-label" for="tarjeta">
                                    Tarjeta de Crédito/Débito
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="metodo_pago" id="paypal" value="paypal">
                                <label class="form-check-label" for="paypal">
                                    PayPal
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="metodo_pago" id="efectivo" value="efectivo">
                                <label class="form-check-label" for="efectivo">
                                    Pago en Efectivo
                                </label>
                            </div>
                        </div>
                        
                        <div id="tarjetaDetalles" class="mb-3">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="numeroTarjeta" class="form-label">Número de Tarjeta</label>
                                    <input type="text" class="form-control" id="numeroTarjeta" placeholder="1234 5678 9012 3456">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="fechaVencimiento" class="form-label">Fecha de Vencimiento</label>
                                    <input type="text" class="form-control" id="fechaVencimiento" placeholder="MM/AA">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="cvv" class="form-label">CVV</label>
                                    <input type="text" class="form-control" id="cvv" placeholder="123">
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            Confirmar Pedido
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Resumen del Pedido</h5>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in items %}
                                <tr>
                                    <td>{{ item.producto.nombre }}</td>
                                    <td>{{ item.cantidad }}</td>
                                    <td>${{ "%.2f"|format(item.producto.precio * item.cantidad) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <hr>
                    
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal:</span>
                        <span>${{ "%.2f"|format(total) }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Envío:</span>
                        <span>Gratis</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between mb-3">
                        <strong>Total:</strong>
                        <strong>${{ "%.2f"|format(total) }}</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tarjetaDetalles = document.getElementById('tarjetaDetalles');
    const metodoPagoInputs = document.querySelectorAll('input[name="metodo_pago"]');
    
    metodoPagoInputs.forEach(input => {
        input.addEventListener('change', function() {
            if (this.value === 'tarjeta') {
                tarjetaDetalles.style.display = 'block';
            } else {
                tarjetaDetalles.style.display = 'none';
            }
        });
    });
    
    // Formatear número de tarjeta
    const numeroTarjeta = document.getElementById('numeroTarjeta');
    numeroTarjeta.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/(\d{4})/g, '$1 ').trim();
        e.target.value = value;
    });
    
    // Formatear fecha de vencimiento
    const fechaVencimiento = document.getElementById('fechaVencimiento');
    fechaVencimiento.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length >= 2) {
            value = value.slice(0,2) + '/' + value.slice(2,4);
        }
        e.target.value = value;
    });
    
    // Formatear CVV
    const cvv = document.getElementById('cvv');
    cvv.addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/\D/g, '').slice(0,3);
    });
});
</script>
{% endblock %} 